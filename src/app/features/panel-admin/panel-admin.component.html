<div class="d-flex min-vh-100">

  <!-- Sidebar -->
  <nav class="sidebar text-white px-4 py-4"
    style="width: 250px; background: linear-gradient(180deg, #0062cc, #004b8d);">
    <h4 class="fw-bold mb-4">üèä Natation Admin</h4>
    <ul class="nav flex-column gap-3">
      <li><a class="nav-link text-white fw-semibold" (click)="view = 'equipes'">üìã √âquipes</a></li>
      <li><a class="nav-link text-white fw-semibold" (click)="view = 'piscines'">üèä Piscines</a></li>
      <li><a class="nav-link text-white fw-semibold" (click)="view = 'acces'">üë§ Acc√®s</a></li>
    </ul>
  </nav>

  <div *ngIf="view === 'equipes'">
    <div class="flex-grow-1 d-flex flex-column bg-light">
      <header class="bg-white shadow-sm p-3 px-4 d-flex justify-content-between align-items-center border-bottom">
        <h5 class="mb-0 text-primary">Dashboard Admin</h5>
        <span class="text-muted">Bonjour, Admin üëã</span>
      </header>

      <main class="p-4 flex-grow-1">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h3 class="fw-bold text-primary d-flex align-items-center gap-2">
            <i class="pi pi-users"></i> √âquipes de natation
          </h3>

          <div>
            <div class="text-center my-4">
              <!-- Exemple am√©lior√© -->
              <button pButton class="p-button-rounded p-button-success shadow-sm px-3 py-2" (click)="openAddForm()">
                <i class="pi pi-plus me-2"></i> Ajouter une √âquipe
              </button>

            </div>
          </div>
        </div>

        <!-- Dialog Ajout / Modif -->
        <p-dialog [header]="editMode ? 'Modifier √âquipe' : 'Nouvelle √âquipe'" [(visible)]="displayAddForm"
          [modal]="true" [style]="{ width: '480px', borderRadius: '16px' }" [dismissableMask]="true"
          styleClass="custom-dialog-shadow">

          <form (ngSubmit)="ajouterEquipe(formAjout)" #formAjout="ngForm" class="form-equipe">

            <div class="field">
              <label for="nom" class="label-custom">Nom de l'√©quipe</label>
              <input id="nom" name="nom" type="text" pInputText class="input-custom" required
                placeholder="Ex : Les Aigles" [(ngModel)]="newEquipe.nom" />
            </div>

            <div class="field">
              <label for="coachEmail" class="label-custom">Email du Coach</label>
              <input id="coachEmail" name="coachEmail" type="email" pInputText class="input-custom" required
                placeholder="coach@example.com" [(ngModel)]="newEquipe.coachEmail" />
            </div>

            <div class="button-container">
              <button type="submit" pButton class="btn-submit" [disabled]="!formAjout.valid">
                {{ editMode ? 'Modifier' : 'Ajouter' }}
              </button>
            </div>

          </form>
        </p-dialog>


        <!-- Liste cartes √©quipes -->
        <div class="row g-4" style="row-gap: 2rem;">
          <div class="col-md-6 col-lg-4 team-card" *ngFor="let equipe of equipes; let i = index">
            <div class="card-content">
              <h5 class="team-name">√âquipe: {{ equipe.nom }}</h5>
              <p class="coach-email"><strong>Coach Email :</strong> {{ equipe.coach?.user?.email || 'Non renseign√©' }}
              </p>
            </div>
            <div class="card-actions">
              <button pButton class="btn-view" (click)="voirEquipe(equipe)">
                <i class="pi pi-eye"></i> Voir
              </button>

              <button pButton class="btn-edit" (click)="modifierEquipe(i)">
                <i class="pi pi-pencil"></i> Modifier
              </button>

              <button pButton class="btn-delete" (click)="supprimerEquipe(i)">
                <i class="pi pi-trash"></i> Supprimer
              </button>
            </div>
          </div>
        </div>

        <!-- Dialog d√©tails √©quipe -->
        <p-dialog header="D√©tails de l'√âquipe" [(visible)]="displayViewDialog" [modal]="true"
          [style]="{ width: '400px' }" [closable]="true" [dismissableMask]="true" styleClass="rounded-lg">
          <div *ngIf="selectedEquipe" class="p-fluid">
            <!-- <img
            [src]="selectedEquipe.imagePath"
            alt="Image √©quipe"
            class="w-full rounded shadow mb-3"
            style="max-height: 200px; object-fit: cover;"
          /> -->
            <h4 class="text-primary">{{ selectedEquipe.nom }}</h4>
            <p><strong>Coach Email :</strong> {{ selectedEquipe.coach?.user?.email || 'Non renseign√©' }}</p>
          </div>
        </p-dialog>
      </main>
    </div>
  </div>



























  <!-- Section gestion des piscines -->
  <div *ngIf="view === 'piscines'" class="flex-grow-1 d-flex flex-column bg-light">

    <!-- Topbar -->
    <header class="bg-white shadow-sm p-3 px-4 d-flex justify-content-between align-items-center border-bottom">
      <h5 class="mb-0 text-primary fw-bold">Dashboard Admin</h5>
      <span class="text-muted">Bonjour, Admin üëã</span>
    </header>

    <!-- Contenu principal -->
    <main class="p-4 flex-grow-1">

      <!-- Titre + bouton -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-primary">üèä Liste des Piscines</h3>
        <button pButton class="p-button-success" (click)="
          displayAddPiscine = true; 
          editModePiscine = false; 
          newPiscine = { nom: '', adresse: '', nombreCouloirs: 0, disponible: false, couloirs: [] };
        ">
          Ajouter
        </button>
      </div>

      <!-- Dialog ajout/modification (sans couloirs) -->
      <p-dialog [(visible)]="displayAddPiscine" [modal]="true" [style]="{ width: '500px' }" [closable]="true"
        [dismissableMask]="true" [header]="editModePiscine ? 'Modifier Piscine' : 'Nouvelle Piscine'"
        styleClass="rounded-lg">

        <form #formPiscine="ngForm"
          (ngSubmit)="editModePiscine ? validerModificationPiscine(formPiscine) : ajouterPiscine(formPiscine)"
          class="p-fluid">

          <div class="field mb-3">
            <label for="nomPiscine">Nom</label>
            <input id="nomPiscine" name="nomPiscine" type="text" pInputText [(ngModel)]="newPiscine.nom" required
              #nomPiscine="ngModel">
            <small *ngIf="nomPiscine.invalid && nomPiscine.touched" class="p-error">Le nom est obligatoire.</small>
          </div>

          <div class="field mb-3">
            <label for="adressePiscine">Adresse</label>
            <input id="adressePiscine" name="adressePiscine" type="text" pInputText [(ngModel)]="newPiscine.adresse"
              required #adressePiscine="ngModel">
            <small *ngIf="adressePiscine.invalid && adressePiscine.touched" class="p-error">L'adresse est
              obligatoire.</small>
          </div>

          <div class="field mb-3">
            <label for="nombreCouloirsPiscine">Nombre de couloirs</label>
            <input id="nombreCouloirsPiscine" name="nombreCouloirsPiscine" type="number" pInputText
              [(ngModel)]="newPiscine.nombreCouloirs" required min="0" #nombreCouloirsPiscine="ngModel">
            <small *ngIf="nombreCouloirsPiscine.invalid && nombreCouloirsPiscine.touched" class="p-error">
              Le nombre de couloirs est obligatoire et doit √™tre &gt;= 0.
            </small>
          </div>

          <div class="field-checkbox mb-3 d-flex align-items-center">
            <p-checkbox inputId="disponiblePiscine" binary="true" [(ngModel)]="newPiscine.disponible"
              name="disponiblePiscine"></p-checkbox>
            <label for="disponiblePiscine" class="ms-2 mb-0">Disponible</label>
            <p class="ms-3 mb-0">Valeur: {{ newPiscine.disponible }}</p>
          </div>

          <div class="text-end mt-3">
            <button pButton type="submit" class="p-button-success" icon="pi pi-check" [disabled]="formPiscine.invalid">
              {{ editModePiscine ? 'Modifier' : 'Ajouter' }}
            </button>
          </div>
        </form>

      </p-dialog>

      <!-- Dialog gestion des couloirs -->
      <p-dialog [(visible)]="displayCouloirDialog" [modal]="true" [style]="{ width: '600px' }" [closable]="true"
        [dismissableMask]="true" [header]="'G√©rer les couloirs de ' + selectedPiscine?.nom" styleClass="rounded-lg">

        <div *ngIf="selectedPiscine">

          <!-- Liste des couloirs existants -->
          <div *ngIf="newCouloirs.length > 0" class="mb-4">
            <h6 class="text-muted">Couloirs existants :</h6>
            <ul class="list-group">
              <li *ngFor="let couloir of newCouloirs; let i = index"
                class="list-group-item d-flex justify-content-between align-items-center">

                <div>
                  <strong>Couloir {{ couloir.numero || (i + 1) }}</strong> - {{ couloir.nom || 'Sans nom' }} ({{
                  couloir.longueur }} m)
                </div>

                <button type="button" class="btn btn-sm btn-outline-danger" (click)="supprimerCouloir(i)">
                  üóëÔ∏è Supprimer
                </button>
              </li>
            </ul>
          </div>

          <!-- Formulaire ajout d‚Äôun nouveau couloir -->
          <form #formCouloir="ngForm" (ngSubmit)="ajouterCouloir()" class="p-fluid">

            <div class="field mb-3">
              <label for="nomCouloir">Nom du couloir</label>
              <input id="nomCouloir" name="nomCouloir" type="text" pInputText [(ngModel)]="newCouloir.nom" required>
            </div>

            <div class="field mb-3">
              <label for="longueurCouloir">Longueur (m)</label>
              <input id="longueurCouloir" name="longueurCouloir" type="number" pInputText
                [(ngModel)]="newCouloir.longueur" required>
            </div>

            <div class="text-end mt-2">
              <button pButton type="submit" class="p-button-info" icon="pi pi-plus" [disabled]="formCouloir.invalid">
                Ajouter Couloir
              </button>
            </div>
          </form>

          <!-- Boutons Valider et Fermer -->
          <div class="text-end mt-4">
            <button pButton type="button" class="p-button-success me-2" (click)="validerCouloirs()">
              Valider les couloirs
            </button>
            <button pButton type="button" class="p-button-secondary" (click)="displayCouloirDialog = false">
              Fermer
            </button>
          </div>

        </div>
      </p-dialog>

      <!-- Grille de cartes -->
      <div class="row g-4 mt-2">
        <div class="col-md-6 col-lg-4" *ngFor="let piscine of piscines; let i = index">

          <div class="card shadow-sm border-0 h-100 rounded-4">
            <div class="card-body pb-1">
              <h5 class="card-title text-info fw-bold">{{ piscine.nom }}</h5>
              <p class="mb-1"><strong>Adresse :</strong> {{ piscine.adresse }}</p>
              <p class="mb-1"><strong>Nombre de couloirs :</strong> {{ piscine.couloirs?.length || 0 }}</p>
              <ul class="mb-1 ps-3">
                <li *ngFor="let couloir of piscine.couloirs; let i = index">
                  Couloir {{ couloir.numero || (i + 1) }} - {{ couloir.nom || 'Sans nom' }} - {{ couloir.longueur }} m
                </li>
              </ul>
            </div>
            <div class="card-footer border-0 bg-white pt-3 d-flex justify-content-center gap-2 flex-wrap">
              <button type="button" class="btn btn-outline-info btn-sm" (click)="modifierPiscine(i)">
                ‚úèÔ∏è Modifier
              </button>
              <button type="button" class="btn btn-outline-danger btn-sm" (click)="supprimerPiscine(i)">
                üóëÔ∏è Supprimer
              </button>
              <button type="button" class="btn btn-outline-secondary btn-sm" (click)="gererCouloirs(piscine)">
                ‚ûï G√©rer les couloirs
              </button>
            </div>
          </div>

        </div>
      </div>

    </main>
  </div>








  <!-- Section gestion des acc√®s -->
  <div *ngIf="view === 'acces'" class="acces-section"
    style="padding: 2rem; background-color: #f5f9ff; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); width:100%">
    <h2 style="font-size: 24px; margin-bottom: 1rem; color: #0b3d91">Gestion des acc√®s</h2>

    <div *ngIf="message" class="message-success"
      style="background-color: #d1f7d6; color: #155724; padding: 0.5rem 1rem; border-radius: 8px; margin-bottom: 1rem;">
      {{ message }}
    </div>

    <!-- Liste des utilisateurs -->
    <table class="user-table"
      style="width: 100%; border-collapse: collapse; background: #fff; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
      <thead style="background-color: #e0f0ff; color: #0b3d91;">
        <tr>
          <th style="padding: 1rem; text-align: left;">ID</th>
          <th style="padding: 1rem; text-align: left;">Email</th>
          <th style="padding: 1rem; text-align: left;">R√¥le actuel</th>
          <th style="padding: 1rem; text-align: left;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of users" style="border-top: 1px solid #eee;">
          <td style="padding: 0.75rem;">{{ user.id }}</td>
          <td style="padding: 0.75rem;">{{ user.email }}</td>
          <td style="padding: 0.75rem;">
            <span
              style="background-color: #e0f0ff; color: #0b3d91; padding: 0.3rem 0.6rem; border-radius: 12px; font-size: 0.875rem;">
              {{ user.type }}
            </span>
          </td>
          <td style="padding: 0.75rem;">
            <button class="btn-delete" (click)="deleteUser(user.id)"
              style="background-color: #ff6b6b; color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer;">Supprimer</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Formulaire assigner r√¥le -->
    <h3 style="margin-top: 2rem; font-size: 20px; color: #0b3d91;">Attribuer un r√¥le √† un utilisateur</h3>

    <div style="display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; margin-top: 1rem;">
      <div style="flex: 1;">
        <label for="userSelect" style="display: block; margin-bottom: 0.5rem;">Utilisateur :</label>
        <select id="userSelect" [(ngModel)]="selectedUserId" name="userSelect"
          style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc;">
          <option [ngValue]="undefined">-- S√©lectionner --</option>
          <option *ngFor="let user of users" [value]="user.id">{{ user.email }}</option>
        </select>
      </div>

      <div style="flex: 1;">
        <label for="roleSelect" style="display: block; margin-bottom: 0.5rem;">R√¥le :</label>
        <select id="roleSelect" [(ngModel)]="selectedRole" name="roleSelect"
          style="width: 100%; padding: 0.5rem; border-radius: 8px; border: 1px solid #ccc;">
          <option [ngValue]="undefined">-- S√©lectionner --</option>
          <option *ngFor="let role of roles" [value]="role">{{ role }}</option>
        </select>
      </div>

      <div style="flex-shrink: 0; align-self: end;">
        <button class="btn-assign" (click)="assignRole()"
          style="background-color: #0b3d91; color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer;">
          Attribuer r√¥le
        </button>
      </div>
    </div>
  </div>