<form #form="ngForm" (ngSubmit)="onSubmit(form)" class="form" novalidate>
  <h2>Réservation du coach – Piscine</h2>

  <!-- Date -->
  <div class="field">
    <label for="date">Date</label>
    <input id="date" type="date" name="date" [(ngModel)]="reservation.date" required #date="ngModel" />
    <div *ngIf="date.invalid && date.touched" class="text-danger">La date est requise.</div>
  </div>

  <!-- Heures -->
  <div class="row">
    <div class="col-md-12 d-flex">
      <div class="field me-3 flex-grow-1">
        <label for="startTime">Heure Début</label>
        <input id="startTime" type="time" name="startTime" [(ngModel)]="reservation.startTime" required #startTime="ngModel" />
        <div *ngIf="startTime.invalid && startTime.touched" class="text-danger">L'heure de début est requise.</div>
      </div>

      <div class="field flex-grow-1">
        <label for="endTime">Heure Fin</label>
        <input id="endTime" type="time" name="endTime" [(ngModel)]="reservation.endTime" required #endTime="ngModel" />
        <div *ngIf="endTime.invalid && endTime.touched" class="text-danger">L'heure de fin est requise.</div>
        <div *ngIf="reservation.startTime && reservation.endTime && reservation.endTime <= reservation.startTime" class="text-danger">
          L'heure de fin doit être après l'heure de début.
        </div>
      </div>
    </div>
  </div>

  <!-- Équipe -->
  <div class="field">
    <label for="equipe">Équipe</label>
    <select id="equipe" name="equipe" [(ngModel)]="reservation.equipe" required #equipe="ngModel">
      <option value="">-- Choisissez une équipe --</option>
      <option *ngFor="let e of equipes" [value]="e.nom">{{ e.nom }}</option>
    </select>
    <div *ngIf="equipe.invalid && equipe.touched" class="text-danger">L'équipe est requise.</div>
  </div>

  <!-- Piscine -->
  <div class="field">
    <label for="piscine">Piscine</label>
    <select id="piscine" name="piscine" [(ngModel)]="reservation.piscine" (change)="onPiscineChange()" required #piscine="ngModel">
      <option value="">-- Choisissez une piscine --</option>
      <option *ngFor="let p of piscines" [value]="p.nom" [disabled]="!p.disponible">
        {{ p.nom }} {{ !p.disponible ? '(Indisponible)' : '' }}
      </option>
    </select>
    <div *ngIf="piscine.invalid && piscine.touched" class="text-danger">Veuillez choisir une piscine disponible.</div>
  </div>

<div class="field" *ngIf="reservation.piscine && couloirs.length > 0">
  <label for="couloir">Couloir</label>
  <select id="couloir" name="couloir" [(ngModel)]="reservation.couloir" required #couloir="ngModel">
    <option [ngValue]="null">-- Choisissez un couloir --</option>
    <option *ngFor="let c of couloirs" [ngValue]="c.nom">{{ c.nom }}</option>
  </select>
  <div *ngIf="couloir.invalid && couloir.touched" class="text-danger">Veuillez choisir un couloir.</div>
</div>


  <!-- Bouton de soumission -->
  <button
    type="submit"
    [disabled]="form.invalid || (reservation.endTime && reservation.startTime && reservation.endTime <= reservation.startTime)"
    [ngClass]="{
      'btn-disabled': form.invalid || (reservation.endTime <= reservation.startTime),
      'btn-active': form.valid && reservation.endTime > reservation.startTime
    }"
  >
    Réserver
  </button>
</form>

<!-- Modal de confirmation -->
<div class="modal" *ngIf="submitted && confirmationReservation" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <span class="close" (click)="closeModal()">&times;</span>
    <h3>Réservation confirmée</h3>
    <ul>
      <li><strong>Date :</strong> {{ confirmationReservation.date }}</li>
      <li><strong>Heure :</strong> {{ confirmationReservation.startTime }} – {{ confirmationReservation.endTime }}</li>
      <li><strong>Équipe :</strong> {{ confirmationReservation.equipe }}</li>
      <li><strong>Piscine :</strong> {{ confirmationReservation.piscine }}</li>
      <li><strong>Couloir :</strong> {{ confirmationReservation.couloir }}</li>
    </ul>
    <button (click)="closeModal()">Fermer</button>
  </div>
</div>
