<div *ngIf="hasError" class="error-container">
  <p class="error-message">
    ⚠️ Erreur : Athlète introuvable ou ID manquant dans l’URL.
  </p>
</div>

<mat-card *ngIf="!hasError && athlete" class="profile-card">
  <mat-card-header>
    <img mat-card-avatar [src]="athlete.image" alt="{{ athlete.nom }}" />
    <mat-card-title>{{ athlete.nom }}</mat-card-title>
    <mat-card-subtitle>
      {{ athlete.discipline }} · {{ athlete.specialite }}
    </mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <p>{{ athlete.description }}</p>
    <p><strong>Record :</strong> {{ athlete.record }}</p>
    <p><strong>Âge :</strong> {{ athlete.age }}</p>
    <p><strong>Titre :</strong> {{ athlete.titre }}</p>
  </mat-card-content>
</mat-card>

<mat-accordion *ngIf="!hasError && athlete" class="classements-accordion" [multi]="false" hideToggle>
  <mat-expansion-panel #panel>
    <mat-expansion-panel-header>
      <mat-panel-title>Classements</mat-panel-title>
      <mat-panel-description>
        {{ panel.expanded ? 'Réduire' : 'Voir' }}
      </mat-panel-description>
    </mat-expansion-panel-header>

    <div class="classements-content" [@expandCollapse]>
      <table mat-table [dataSource]="dataSource" class="ranking-table">
        <ng-container matColumnDef="event">
          <th mat-header-cell *matHeaderCellDef>Événement</th>
          <td mat-cell *matCellDef="let r">{{ r.eventName }}</td>
        </ng-container>
        <ng-container matColumnDef="place">
          <th mat-header-cell *matHeaderCellDef>Classement</th>
          <td mat-cell *matCellDef="let r">{{ r.place }}</td>
        </ng-container>
        <ng-container matColumnDef="points">
          <th mat-header-cell *matHeaderCellDef>Points</th>
          <td mat-cell *matCellDef="let r">{{ r.points }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div class="classements-actions">
        <button class="btn export-btn" (click)="downloadCsv()">📄 CSV</button>
        <button class="btn export-btn" (click)="downloadRankingsTextPdf()">📑 PDF</button>
        <button class="btn export-btn" (click)="shareCsv()">🔗 Partager</button>
      </div>
    </div>
  </mat-expansion-panel>
</mat-accordion>

<div *ngIf="!hasError && athlete" class="calendar-wrapper">
  <div class="calendar-actions">
    <button class="btn menu-btn" (click)="menuOpen = !menuOpen" [disabled]="modalOpen">⚙️ Actions</button>
    <div class="actions-dropdown" *ngIf="menuOpen">
      <button class="btn dropdown-btn" (click)="downloadCalendarImage()">📷 Capture</button>
      <button class="btn dropdown-btn" (click)="downloadCalendarPdf()">📄 PDF</button>
      <button class="btn dropdown-btn" (click)="downloadCalendarTextPdf()">📑 Texte</button>
    </div>
  </div>
  <div #calendarWrap>
    <full-calendar [options]="calendarOptions"></full-calendar>
  </div>
</div>
